{% extends 'base.html.twig' %}

{% block title %}SgrEvento index{% endblock %}

{% block stylesheets %}
    
    
    <link href="/build/bootstrap-datetimepicker.css" rel="stylesheet">
    <link href="/build/bootstrap-datetimepicker-standalone.min.css" rel="stylesheet">

    <!-- 
    
    <link href="/reservasfgh/public/build/bootstrap-datetimepicker.css" rel="stylesheet">
    <link href="/reservasfgh/public/build/bootstrap-datetimepicker-standalone.min.css" rel="stylesheet">
    
    -->
{% endblock %}


{% block body %}
	<div class="row">
		<p>Información, navegación y configuración</p>
		<div id="Filtros">
       		<div class="mt-3 mb-3">
            	{{ include('sgr_calendarios/_form.html.twig', {'button_label': 'Mostrar eventos'}) }}
        	</div>
    </div>
	</div>
	
	<div class="row">
	<div class="col">
		
	<table class="table table-striped table-bordered ">
		<caption>Cuadrante de ocupación</caption>
		<thead class="thead-dark">
			<tr>
				<th scope="col" style="max-width: 100px"><div class="col">Hora</div></th>
				
				{% set start_h = constant('\\App\\Entity\\SgrEvento::H_INICIO_MIN') | date('U') %}
				{% set end_h = constant('\\App\\Entity\\SgrEvento::H_FIN_MAX') | date('U') %}	
				{% set step = 180*60 %} {# 3 horas en segundos #}
				{% set setpMinutes = 180 %} {# 3 horas en minutos #}
				
				 
				{% for hour in range(start_h, end_h, step) %}
				
						<th scope="col" >
							<div class="col text-center" ><span >{{ hour|date('H:i') }}</span> - <span>{{ (hour + step)|date('H:i') }}</span></div>
						</th>
				{% endfor %}
				
				
			</tr>
		</thead>
		<tbody>
					
			{% for calendario in aCalendarios %}
				<tr>
					<th scope="row" >
						<div class="col">{{ calendario.sgrEspacio.nombre }}</div>
					</th>
				{% for hour in range(start_h, end_h, step) %}	
					<td style="padding: 0px;">
						<div class="e" style="position: relative;min-height: 50px;height: 100%;">

							
							<div style="width:100%;position: absolute;min-height: 35px;height: 100%;">
								{% for i in range(0,2) %}
									<div style="float: left;width: 33%;height: 100%;border-left: 1px dotted gray;"></div>	
								{% endfor %}

							</div>
						
							{% if not calendario.periods is empty %}

								{% for period in calendario.periods %}
									
									{% set counter = ( counter | default(0) ) + 1 %}
									
									{% if period.datePeriod.start|date('H:i') >= hour|date('H:i') and period.datePeriod.start|date('H:i') < (hour+step)|date('H:i') %}


										{% set fp =  date( period.datePeriod.start|date('H:i') )  %}
										{% set fp_fin =  date( period.datePeriod.end|date('H:i') )  %}
										{% set duration = (fp_fin.diff(fp).format('%H')*60 + fp_fin.diff(fp).format('%i')) %}
										{% set  d = 100*duration / 180 %}
										{% set fh =  date( hour|date('H:i') )  %}
										{% set diffInMinutes = (fh.diff(fp).format('%H')*60 + fh.diff(fp).format('%i')) %}
										{% set offset = 100*diffInMinutes / 180 %}
										{% set w = 100 - offset %}
								
										<div style="z-index: 2;
											width: {{ d }}%;
											position:absolute;
											top:0px;
											left:{{ offset }}%;
											background-color: #bbb;
											height: 50px;">
											<a  href="#" tabindex="{{ counter }}" data-trigger="focus" data-html="true"  data-toggle="popover" title="Información de la Reserva" data-content="
											<p>Actividad: {{ period.evento.actividad }}</p>
											<p>f_inicio:{{ period.evento.fInicio|date('d-m-Y') }}, f_fin: {{ period.evento.fFin|date('d-m-Y') }}</p>
											<p>h_inicio: {{ period.evento.hInicio|date('H:i')}}, h_fin {{ period.evento.hFin|date('H:i') }}</p>"
											>	
												<div class="badge badge-primary text-wrap p-2" style="width: 100%;height: 50px;">
	  												<div class="align-middle">
	  												{{ period.evento.titulo }}
	  												</div>
	  												<div class="align-bottom">
	  														<span class="text-sm-left"><small class="align-bottom">{{ period.evento.hInicio|date('H:i') }}</small></span>
	  														<span class="text-sm-right"><small class="align-bottom">{{ period.evento.hFin|date('H:i') }}</small></span>
	  												</div>	
	  											</div>
  											</a>		
										</div>
									{% endif %}
								{% endfor %}
							{% endif %}
						
						</div>

					</td>
				{% endfor %}
			</tr>
			{% endfor %}
		</tbody>
	</table>
	</div><!-- /.col -->
	</div><!-- /.row -->

{% endblock %}

{% block morescripts %}
<script type="text/javascript">        
	$(function () {
 		$('[data-toggle="popover"]').popover({
 			trigger: 'focus',
  		});
 	});
</script>
{% endblock %}